<!DOCTYPE html>
<html>
<head>
  <title>Debug Extension</title>
  <script src="https://extensions.tableauusercontent.com/resources/tableau.extensions.1.latest.min.js"></script>
</head>
<body>
  <h1 id="status">Loading...</h1>
  <pre id="log"></pre>

  <script>
    var log = document.getElementById('log');
    log.innerHTML = '1. Script started\n';
    log.innerHTML += '2. typeof tableau = ' + typeof tableau + '\n';

    if (typeof tableau !== 'undefined') {
      log.innerHTML += '3. Calling initializeAsync...\n';
      tableau.extensions.initializeAsync().then(function() {
        log.innerHTML += '4. Connected!\n';
        document.getElementById('status').innerText = 'Connected!';

        var dashboard = tableau.extensions.dashboardContent.dashboard;
        log.innerHTML += '5. Worksheets: ' + dashboard.worksheets.length + '\n';

        if (dashboard.worksheets.length > 0) {
          dashboard.worksheets[0].getSummaryDataAsync().then(function(data) {
            log.innerHTML += '6. Got ' + data.data.length + ' rows\n';
            log.innerHTML += '7. Columns: ' + data.columns.map(function(c){return c.fieldName}).join(', ') + '\n';
            document.getElementById('status').innerText = 'Success! ' + data.data.length + ' rows';
          }).catch(function(e) {
            log.innerHTML += 'Data error: ' + e + '\n';
          });
        }
      }).catch(function(e) {
        log.innerHTML += 'Init error: ' + e + '\n';
      });
    } else {
      log.innerHTML += 'ERROR: tableau is undefined\n';
      document.getElementById('status').innerText = 'ERROR: No tableau object';
    }
  </script>
</body>
</html>
